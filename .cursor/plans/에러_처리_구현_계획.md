# 에러 처리 구현 계획

## 현재 상태 분석

### 이미 구현된 에러 처리
1. **Client Component에서 지역 목록 로드 에러 처리** (`components/tour-filters.tsx`)
   - `useState`로 에러 상태 관리 (`areasError`)
   - 에러 발생 시 기본 지역 목록 (`DEFAULT_AREAS`) 사용
   - 에러 메시지 UI 표시

2. **관광지 데이터 조회 에러 처리** (`app/page.tsx`)
   - try-catch로 에러 캐치
   - error 변수에 저장하여 TourList 컴포넌트에 전달
   - TourList에서 Error 컴포넌트로 표시

3. **API 레벨 에러 처리** (`lib/api/tour-api.ts`)
   - `handleApiError()` 함수로 API 에러 처리
   - 재시도 로직 (`retryRequest()`)
   - 사용자 친화적인 에러 메시지 변환

### 미구현/개선 필요 항목
1. **Server Component에서 지역 목록 로드 실패 시 처리** (`app/page.tsx`)
   - 현재: 에러를 콘솔에만 출력하고 빈 배열 유지
   - 개선: 기본 지역 목록 사용 또는 에러 상태 전달

2. **필터 변경 실패 시 처리** (`components/tour-filters.tsx`)
   - 현재: URL 업데이트 실패에 대한 처리 없음
   - 개선: URL 업데이트 실패 시 롤백 및 사용자 알림

3. **에러 메시지 사용자 알림**
   - Toast 알림 추가 (선택 사항)
   - 에러 발생 시 사용자에게 명확한 피드백 제공

## 구현 계획

### 1. Server Component에서 지역 목록 로드 실패 시 처리

#### 1.1 기본 지역 목록 사용
- **파일**: `app/page.tsx`
- **위치**: 75-81줄 (지역 목록 로드 부분)
- **구현 내용**:
  - 에러 발생 시 `DEFAULT_AREAS` 사용
  - `lib/constants/areas.ts`에서 `DEFAULT_AREAS` import
  - 에러 로그는 유지하되 기본 지역 목록으로 fallback

#### 1.2 에러 상태 전달 (선택 사항)
- **파일**: `app/page.tsx`
- **구현 내용**:
  - 지역 목록 로드 실패 시 에러 상태를 TourFilters에 전달
  - TourFilters에서 에러 상태에 따라 경고 메시지 표시

### 2. 필터 변경 실패 시 처리

#### 2.1 URL 업데이트 실패 감지
- **파일**: `components/tour-filters.tsx`
- **위치**: `updateParams` 함수 (약 306줄)
- **구현 내용**:
  - `router.push()` 호출을 try-catch로 감싸기
  - 에러 발생 시 이전 상태로 롤백
  - 사용자에게 에러 알림 (Toast 또는 Alert)

#### 2.2 에러 상태 관리
- **파일**: `components/tour-filters.tsx`
- **구현 내용**:
  - 필터 변경 에러 상태 관리 (`useState`)
  - 에러 메시지 표시 UI
  - 에러 발생 시 자동으로 이전 URL 상태로 복원

#### 2.3 Toast 알림 추가 (선택 사항)
- **파일**: `components/tour-filters.tsx`
- **구현 내용**:
  - 필터 변경 실패 시 Toast 알림 표시
  - `lib/utils/toast.ts`의 `toastError` 함수 사용
  - 사용자 친화적인 에러 메시지

### 3. 에러 처리 유틸리티 함수 (선택 사항)

#### 3.1 에러 타입 분류 함수
- **파일**: `lib/utils/error.ts` (새로 생성)
- **구현 내용**:
  - 에러 타입 분류 (네트워크, 서버, 클라이언트 등)
  - 사용자 친화적인 에러 메시지 변환
  - 에러 복구 가능 여부 판단

## 구현 세부사항

### Server Component 지역 목록 로드 에러 처리

```typescript
// app/page.tsx
import { DEFAULT_AREAS } from '@/lib/constants/areas';

// 지역 목록 로드
let areas: Awaited<ReturnType<typeof getAreaCode>> = [];
try {
  areas = await getAreaCode({ numOfRows: 100 });
} catch (err) {
  console.error('지역 목록 조회 오류:', err);
  // 기본 지역 목록 사용
  areas = DEFAULT_AREAS;
}
```

### 필터 변경 실패 시 처리

```typescript
// components/tour-filters.tsx
const [filterError, setFilterError] = useState<string | null>(null);

const updateParams = (updates: Partial<FilterParams>) => {
  try {
    // 이전 URL 상태 저장 (롤백용)
    const previousParams = searchParams.toString();
    
    const updatesWithPageReset = {
      ...updates,
      page: DEFAULT_FILTERS.page,
    };

    const newParams = updateFilterParams(searchParams, updatesWithPageReset);
    router.push(`/?${newParams.toString()}`);
    
    // 성공 시 에러 상태 초기화
    setFilterError(null);
  } catch (err) {
    console.error('필터 변경 실패:', err);
    setFilterError('필터를 변경할 수 없습니다. 다시 시도해주세요.');
    
    // 이전 상태로 롤백 (선택 사항)
    // router.push(`/?${previousParams}`);
    
    // Toast 알림 (선택 사항)
    // toastError('필터 변경에 실패했습니다.');
  }
};
```

### 에러 메시지 UI

```tsx
{/* 필터 변경 에러 메시지 */}
{filterError && (
  <Alert variant="destructive" className="mb-4">
    <AlertCircle className="h-4 w-4" />
    <AlertTitle>필터 변경 실패</AlertTitle>
    <AlertDescription>{filterError}</AlertDescription>
  </Alert>
)}
```

## 검증 체크리스트

- [ ] Server Component에서 지역 목록 로드 실패 시 기본 지역 목록 사용 확인
- [ ] 필터 변경 실패 시 에러 감지 및 처리 확인
- [ ] URL 업데이트 실패 시 롤백 기능 확인 (선택 사항)
- [ ] 에러 메시지 사용자 알림 확인 (Toast 또는 Alert)
- [ ] 에러 발생 시 사용자 경험 확인 (앱이 깨지지 않음)
- [ ] 기존 기능 정상 작동 확인
- [ ] 타입 안정성 확인
- [ ] 린트 오류 확인

## 주의사항

1. **하위 호환성**: 기존 기능이 정상 작동해야 함
2. **사용자 경험**: 에러 발생 시에도 앱이 사용 가능한 상태 유지
3. **에러 메시지**: 사용자 친화적이고 명확한 메시지 제공
4. **성능**: 에러 처리로 인한 성능 저하 없어야 함
5. **로깅**: 개발 환경에서 에러 로그는 유지

## 선택 사항

- **에러 복구**: 자동 재시도 기능
- **에러 리포트**: 에러 발생 시 자동 리포트 수집
- **오프라인 감지**: 네트워크 오류 시 오프라인 메시지 표시

