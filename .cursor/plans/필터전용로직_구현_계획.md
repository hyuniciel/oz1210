# 필터 전용 로직 구현 계획

## 현재 상태 분석

### 현재 필터 로직 분산 상황
1. **`components/tour-filters.tsx`**
   - URL 파라미터 업데이트 로직 (`updateParams` 함수)
   - 필터 상태 읽기 및 파싱
   - 필터 변경 핸들러들

2. **`app/page.tsx`**
   - 필터 파라미터 읽기 및 파싱
   - 필터 기본값 설정
   - 필터 조합 처리

### 문제점
- 필터 관련 로직이 여러 파일에 분산되어 있어 유지보수가 어려움
- 필터 파라미터 파싱 로직이 중복됨
- 필터 상태 관리 로직이 재사용 불가능

## 구현 계획

### 1. 필터 전용 유틸리티 파일 생성

#### 1.1 `lib/utils/filters.ts` 생성
- **목적**: 필터 관련 모든 로직을 중앙화하여 재사용성과 유지보수성 향상
- **주요 기능**:
  - 필터 파라미터 타입 정의
  - 필터 파라미터 파싱 함수
  - 필터 파라미터 빌더 함수
  - 필터 기본값 관리
  - 필터 상태 검증 함수

### 2. 필터 타입 정의

#### 2.1 필터 상태 인터페이스
```typescript
export interface FilterParams {
  areaCode?: string;
  contentTypeId?: string;
  sort?: 'latest' | 'name';
  petFriendly?: boolean;
  petSize?: string[];
  keyword?: string;
  page?: number;
}
```

#### 2.2 필터 기본값 상수
```typescript
export const DEFAULT_FILTERS = {
  areaCode: '1', // 서울
  sort: 'latest' as const,
  page: 1,
} as const;
```

### 3. 필터 파라미터 파싱 함수

#### 3.1 `parseFilterParams` 함수
- **입력**: URLSearchParams 또는 searchParams 객체
- **출력**: FilterParams 객체
- **기능**:
  - URL 파라미터를 FilterParams 타입으로 변환
  - 기본값 적용
  - 타입 변환 (string → number, string → boolean 등)
  - petSize 파라미터를 배열로 파싱

#### 3.2 `buildFilterParams` 함수
- **입력**: FilterParams 객체
- **출력**: URLSearchParams 또는 쿼리 문자열
- **기능**:
  - FilterParams를 URL 쿼리 파라미터로 변환
  - 기본값 제거 (URL에 포함하지 않음)
  - null/undefined 값 제거
  - 배열을 쉼표로 구분된 문자열로 변환

### 4. 필터 상태 관리 함수

#### 4.1 `getFilterDefaults` 함수
- **기능**: 필터 기본값 반환
- **용도**: 필터 리셋 시 사용

#### 4.2 `mergeFilterParams` 함수
- **기능**: 기존 필터 파라미터와 새로운 파라미터 병합
- **용도**: 필터 변경 시 기존 필터 유지하면서 일부만 업데이트

#### 4.3 `resetFilterParams` 함수
- **기능**: 필터를 기본값으로 리셋 (keyword는 유지)
- **용도**: 필터 리셋 버튼 클릭 시

### 5. 필터 검증 함수

#### 5.1 `validateFilterParams` 함수
- **기능**: 필터 파라미터 유효성 검증
- **검증 항목**:
  - areaCode가 유효한 지역 코드인지
  - contentTypeId가 유효한 타입 ID인지
  - sort가 'latest' 또는 'name'인지
  - petSize 배열이 유효한 크기 값들인지

### 6. 기존 코드 리팩토링

#### 6.1 `components/tour-filters.tsx` 수정
- `updateParams` 함수를 `buildFilterParams` 사용하도록 변경
- 필터 파라미터 읽기를 `parseFilterParams` 사용하도록 변경
- 필터 리셋 로직을 `resetFilterParams` 사용하도록 변경

#### 6.2 `app/page.tsx` 수정
- 필터 파라미터 읽기를 `parseFilterParams` 사용하도록 변경
- 필터 기본값을 `DEFAULT_FILTERS` 상수 사용하도록 변경

## 구현 세부사항

### 파일 구조
```
lib/utils/filters.ts
├── 타입 정의
│   ├── FilterParams 인터페이스
│   └── FilterDefaults 상수
├── 파싱 함수
│   ├── parseFilterParams()
│   └── buildFilterParams()
├── 상태 관리 함수
│   ├── getFilterDefaults()
│   ├── mergeFilterParams()
│   └── resetFilterParams()
└── 검증 함수
    └── validateFilterParams()
```

### 함수 시그니처 예시

```typescript
/**
 * URL 파라미터를 FilterParams 객체로 파싱
 */
export function parseFilterParams(
  params: URLSearchParams | Record<string, string | undefined>
): FilterParams {
  // 구현 내용
}

/**
 * FilterParams 객체를 URL 쿼리 파라미터로 변환
 */
export function buildFilterParams(
  filters: Partial<FilterParams>,
  options?: { keepDefaults?: boolean }
): URLSearchParams {
  // 구현 내용
}

/**
 * 필터 파라미터 병합 (기존 파라미터 유지하면서 일부만 업데이트)
 */
export function mergeFilterParams(
  current: FilterParams,
  updates: Partial<FilterParams>
): FilterParams {
  // 구현 내용
}

/**
 * 필터를 기본값으로 리셋 (keyword는 유지)
 */
export function resetFilterParams(
  current: FilterParams
): FilterParams {
  // 구현 내용
}
```

## 검증 체크리스트

- [ ] `lib/utils/filters.ts` 파일 생성
- [ ] FilterParams 인터페이스 정의
- [ ] DEFAULT_FILTERS 상수 정의
- [ ] parseFilterParams 함수 구현
- [ ] buildFilterParams 함수 구현
- [ ] mergeFilterParams 함수 구현
- [ ] resetFilterParams 함수 구현
- [ ] validateFilterParams 함수 구현 (선택 사항)
- [ ] `components/tour-filters.tsx` 리팩토링
- [ ] `app/page.tsx` 리팩토링
- [ ] 기존 기능 정상 작동 확인
- [ ] 타입 안정성 확인
- [ ] 린트 오류 확인

## 주의사항

1. **하위 호환성**: 기존 코드와의 호환성 유지
2. **타입 안정성**: TypeScript 타입을 명확히 정의
3. **기본값 처리**: 기본값은 URL에 포함하지 않도록 처리
4. **keyword 유지**: 필터 리셋 시 keyword는 유지해야 함
5. **배열 파라미터**: petSize 같은 배열 파라미터는 쉼표로 구분하여 처리

